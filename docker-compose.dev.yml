# Development override for docker-compose
# Use: docker compose -f docker-compose.yml -f docker-compose.dev.yml up
services:
  backend:
    command: >
      sh -c "uv sync && uv run watchfiles
      'uvicorn backend.app.main:app --host 0.0.0.0 --port 5001 --log-level info'
      backend/"
    volumes:
      - ./backend:/app/backend
      - ./pyproject.toml:/app/pyproject.toml
      - ./uv.lock:/app/uv.lock
      - backend-venv:/app/.venv
      - backend-data:/app/data
    environment:
      - PYTHONUNBUFFERED=1
      - PYTHONDONTWRITEBYTECODE=1
      - WATCHFILES_FORCE_POLLING=false

  frontend:
    command: npm run dev
    volumes:
      - ./frontend:/app
      - /app/node_modules
      - /app/.next
    environment:
      - FAST_REFRESH=true
      - WATCHPACK_POLLING=false
      - CHOKIDAR_USEPOLLING=false
      - NEXT_TELEMETRY_DISABLED=1

volumes:
  backend-venv:
  backend-data:
